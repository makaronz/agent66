# Production values for smc-trading-agent
# This file contains production-specific overrides

# Production image configuration
image:
  registry: your-registry.com
  repository: smc-trading/smc-agent
  tag: "v1.0.0"
  pullPolicy: IfNotPresent
  pullSecrets:
    - name: registry-secret

# Production scaling
replicaCount: 5

# Production resources - higher limits for better performance
resources:
  requests:
    memory: "4Gi"
    cpu: "2000m"
    ephemeralStorage: "2Gi"
  limits:
    memory: "8Gi"
    cpu: "4000m"
    ephemeralStorage: "4Gi"

# Aggressive autoscaling for production load
autoscaling:
  enabled: true
  minReplicas: 5
  maxReplicas: 25
  targetCPUUtilizationPercentage: 50
  targetMemoryUtilizationPercentage: 60
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 600  # 10 minutes
      policies:
      - type: Percent
        value: 5  # Scale down slowly
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 30   # 30 seconds
      policies:
      - type: Percent
        value: 100  # Scale up aggressively
        periodSeconds: 30
      - type: Pods
        value: 5
        periodSeconds: 30

# Production service configuration
service:
  type: ClusterIP
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"

# Production ingress with SSL
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
  hosts:
    - host: smc-trading.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: smc-trading-tls
      hosts:
        - smc-trading.yourdomain.com

# Production health checks - more conservative
healthChecks:
  liveness:
    enabled: true
    path: /health
    port: 8080
    initialDelaySeconds: 120  # Longer startup time
    periodSeconds: 30
    timeoutSeconds: 15
    failureThreshold: 5
  readiness:
    enabled: true
    path: /ready
    port: 8080
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3
  startup:
    enabled: true
    path: /health
    port: 8080
    initialDelaySeconds: 60
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 40  # Allow up to 10 minutes for startup

# Production node selection
nodeSelector:
  node-type: production
  instance-type: c5.2xlarge  # High-performance instances

tolerations:
  - key: "production-workload"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"
  - key: "high-performance"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"

# Strong anti-affinity for production
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: app.kubernetes.io/name
          operator: In
          values:
          - smc-trading-agent
      topologyKey: kubernetes.io/hostname
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - smc-trading-agent
        topologyKey: topology.kubernetes.io/zone

# Production environment variables
env:
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  RUST_LOG: "info"
  PYTHONUNBUFFERED: "1"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://jaeger-collector.monitoring.svc.cluster.local:14268"
  OTEL_SERVICE_NAME: "smc-trading-agent"
  OTEL_SERVICE_VERSION: "v1.0.0"

# Production configuration
configMap:
  enabled: true
  data:
    config.yaml: |
      environment: production
      log_level: INFO
      metrics:
        enabled: true
        port: 9090
        path: /metrics
        interval: 15s
      health:
        port: 8080
        liveness_path: /health
        readiness_path: /ready
      trading:
        max_positions: 50
        risk_limit: 0.01  # Conservative risk in production
        stop_loss: 0.005
        position_size_limit: 0.1
        max_daily_trades: 100
      performance:
        worker_threads: 8
        max_connections: 1000
        connection_timeout: 30s
        request_timeout: 10s
      monitoring:
        enable_tracing: true
        trace_sample_rate: 0.1
        enable_profiling: true

# Production storage - larger and faster
persistence:
  data:
    enabled: true
    storageClass: "gp3-encrypted"  # Fast encrypted storage
    accessMode: ReadWriteOnce
    size: 500Gi  # Large data volume
    mountPath: /app/data
  logs:
    enabled: true
    storageClass: "gp3-encrypted"
    accessMode: ReadWriteOnce
    size: 200Gi  # Large log volume
    mountPath: /app/logs

# Production Vault configuration
vault:
  enabled: true
  address: "https://vault.yourdomain.com"
  role: "smc-trading-prod-role"
  secrets:
    database:
      path: "secret/data/smc-trading/prod/database"
      template: |
        {{- with secret "secret/data/smc-trading/prod/database" -}}
        export DATABASE_URL="{{ .Data.data.url }}"
        export DATABASE_PASSWORD="{{ .Data.data.password }}"
        export DATABASE_MAX_CONNECTIONS="{{ .Data.data.max_connections | default "100" }}"
        {{- end }}
    exchanges:
      path: "secret/data/smc-trading/prod/exchanges"
      template: |
        {{- with secret "secret/data/smc-trading/prod/exchanges/binance" -}}
        export BINANCE_API_KEY="{{ .Data.data.api_key }}"
        export BINANCE_API_SECRET="{{ .Data.data.api_secret }}"
        export BINANCE_TESTNET="false"
        {{- end }}
        {{- with secret "secret/data/smc-trading/prod/exchanges/bybit" -}}
        export BYBIT_API_KEY="{{ .Data.data.api_key }}"
        export BYBIT_API_SECRET="{{ .Data.data.api_secret }}"
        export BYBIT_TESTNET="false"
        {{- end }}
        {{- with secret "secret/data/smc-trading/prod/exchanges/oanda" -}}
        export OANDA_API_KEY="{{ .Data.data.api_key }}"
        export OANDA_ACCOUNT_ID="{{ .Data.data.account_id }}"
        export OANDA_ENVIRONMENT="live"
        {{- end }}

# Strict network policy for production
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: monitoring
      - namespaceSelector:
          matchLabels:
            name: ingress-nginx
      - namespaceSelector:
          matchLabels:
            name: prometheus
      ports:
      - protocol: TCP
        port: 8080
      - protocol: TCP
        port: 9090
  egress:
    # Vault access
    - to:
      - namespaceSelector:
          matchLabels:
            name: vault
      ports:
      - protocol: TCP
        port: 8200
    # Database access
    - to:
      - namespaceSelector:
          matchLabels:
            name: database
      ports:
      - protocol: TCP
        port: 5432
    # Redis access
    - to:
      - namespaceSelector:
          matchLabels:
            name: redis
      ports:
      - protocol: TCP
        port: 6379
    # External APIs (exchanges)
    - to: []
      ports:
      - protocol: TCP
        port: 443
      - protocol: TCP
        port: 80
    # DNS
    - to:
      - namespaceSelector:
          matchLabels:
            name: kube-system
      ports:
      - protocol: UDP
        port: 53
    # Monitoring
    - to:
      - namespaceSelector:
          matchLabels:
            name: monitoring
      ports:
      - protocol: TCP
        port: 9090
      - protocol: TCP
        port: 14268

# Production monitoring
monitoring:
  prometheus:
    enabled: true
    scrape: true
    port: 9090
    path: /metrics
    interval: 15s
    scrapeTimeout: 10s
  grafana:
    enabled: true
    dashboards:
      enabled: true

# Production service account with specific annotations
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT:role/smc-trading-agent-role"
  name: "smc-trading-agent-prod"

# Production pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"
  co.elastic.logs/enabled: "true"
  co.elastic.logs/json.keys_under_root: "true"
  co.elastic.logs/json.add_error_key: "true"

# Production pod labels
podLabels:
  version: "v1.0.0"
  environment: "production"
  tier: "application"
  component: "trading-agent"

# Production namespace
namespace:
  create: true
  name: "smc-trading-prod"
  labels:
    name: "smc-trading-prod"
    environment: "production"
    tier: "application"
    istio-injection: "enabled"  # If using Istio

# Production PDB - more conservative
podDisruptionBudget:
  enabled: true
  minAvailable: 3  # Always keep at least 3 pods running

# Disable dependencies - use external managed services
postgresql:
  enabled: false

redis:
  enabled: false
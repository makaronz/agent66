import{r as e,j as t,K as s,aq as r,J as a,b as i,at as o,Y as n}from"./react-m-WA-DAu.js";import{s as c}from"./index-BH92hES8.js";import{s as l,a as d}from"./auth-4gRa0qqt.js";import"./vendor-CCzY5YmT.js";import"./utils-qIfB5D_q.js";const u=({enabled:u,onStatusChange:h})=>{const[m,y]=e.useState([]),[x,g]=e.useState(!1),[b,p]=e.useState(""),[j,f]=e.useState(!1);e.useEffect(()=>{u&&w()},[u]);const w=async()=>{try{const{data:{session:e}}=await c.auth.getSession();if(!e)return;const t=await fetch("/api/webauthn/credentials",{headers:{Authorization:`Bearer ${e.access_token}`}});if(t.ok){const e=await t.json();y(e.credentials||[])}}catch(e){}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(s,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Hardware Security Keys"}),t.jsx("p",{className:"text-gray-600",children:"Use WebAuthn-compatible security keys for the strongest authentication"})]}),u?t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(r,{className:"h-5 w-5 text-green-600"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-green-800",children:"WebAuthn Enabled"}),t.jsxs("p",{className:"text-sm text-green-700",children:["You have ",m.length," security key",1!==m.length?"s":""," registered"]})]})]})}):t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(a,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"No Security Keys Registered"}),t.jsx("p",{className:"text-sm text-yellow-700",children:"Add a security key for the strongest protection"})]})]})}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"What are security keys?"}),t.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[t.jsx("li",{children:"• Physical devices that provide the strongest authentication"}),t.jsx("li",{children:"• Resistant to phishing and man-in-the-middle attacks"}),t.jsx("li",{children:"• Works with USB, NFC, or Bluetooth"}),t.jsx("li",{children:"• Supports FIDO2/WebAuthn standards"})]})]}),m.length>0&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:"Registered Security Keys"}),t.jsx("div",{className:"space-y-2",children:m.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(i,{className:"h-5 w-5 text-green-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Added ",new Date(e.created_at).toLocaleDateString()]})]})]}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to remove this security key?")){g(!0);try{const{data:{session:t}}=await c.auth.getSession();if(!t)return void n.error("Please log in to remove security key");const s=await fetch(`/api/webauthn/credentials/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.access_token}`}});if(s.ok)n.success("Security key removed successfully"),w(),h();else{const e=await s.json();n.error(e.message||"Failed to remove security key")}}catch(t){n.error("Error removing security key")}finally{g(!1)}}})(e.id),disabled:x,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Remove security key",children:t.jsx(o,{className:"h-4 w-4"})})]},e.id))}),t.jsx("button",{onClick:async()=>{g(!0);try{const{data:{session:e}}=await c.auth.getSession();if(!e)return void n.error("Please log in to test authentication");const t=await fetch("/api/webauthn/authenticate/begin",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok){const e=await t.json();return void n.error(e.message||"Failed to start authentication test")}const s=await t.json(),r=await l(s),a=await fetch("/api/webauthn/authenticate/finish",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({credential:r})});if(a.ok)n.success("Security key authentication successful!");else{const e=await a.json();n.error(e.message||"Authentication failed")}}catch(e){"NotAllowedError"===e.name?n.error("Authentication was cancelled or timed out"):n.error("Authentication test failed")}finally{g(!1)}},disabled:x,className:"w-full px-4 py-2 border border-blue-600 text-blue-600 rounded-md hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x?"Testing...":"Test Authentication"})]}),t.jsx("div",{className:"space-y-4",children:j?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Security Key Name"}),t.jsx("input",{type:"text",value:b,onChange:e=>p(e.target.value),placeholder:"e.g., YubiKey 5, Work Laptop Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:50})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(a,{className:"h-5 w-5 text-blue-600 mt-0.5"}),t.jsxs("div",{className:"text-sm text-blue-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Ready to register your security key?"}),t.jsx("p",{children:"Make sure your security key is connected and ready. You'll be prompted to touch or activate it."})]})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>{f(!1),p("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(b.trim()){g(!0);try{const{data:{session:e}}=await c.auth.getSession();if(!e)return void n.error("Please log in to register a security key");const t=await fetch("/api/webauthn/register/begin",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({credentialName:b.trim()})});if(!t.ok){const e=await t.json();return void n.error(e.message||"Failed to start registration")}const s=await t.json(),r=await d(s),a=await fetch("/api/webauthn/register/finish",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({credential:r,credentialName:b.trim()})});if(a.ok)n.success("Security key registered successfully!"),p(""),f(!1),h(),w();else{const e=await a.json();n.error(e.message||"Failed to register security key")}}catch(e){"NotSupportedError"===e.name?n.error("WebAuthn is not supported on this device or browser"):"SecurityError"===e.name?n.error("Security error: Please ensure you're using HTTPS"):"NotAllowedError"===e.name?n.error("Registration was cancelled or timed out"):n.error("Failed to register security key")}finally{g(!1)}}else n.error("Please enter a name for your security key")},disabled:x||!b.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x?"Registering...":"Register Key"})]})]}):t.jsx("button",{onClick:()=>f(!0),disabled:x,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Add Security Key"})})]})};export{u as default};

import{r as e,j as s,aj as t,aq as a,ar as r,J as i,as as l,Y as n}from"./react-m-WA-DAu.js";import{s as o}from"./index-BH92hES8.js";import{L as c}from"./LazyImage-Degy4hjP.js";import"./vendor-CCzY5YmT.js";import"./utils-qIfB5D_q.js";const d=({enabled:d,onStatusChange:x})=>{const[m,u]=e.useState(null),[h,p]=e.useState(""),[b,g]=e.useState(!1),[y,j]=e.useState("initial"),[f,N]=e.useState(!1);return"setup"===y&&m?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx(t,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Set up Authenticator App"}),s.jsx("p",{className:"text-gray-600",children:"Scan the QR code or enter the secret key manually"})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("div",{className:"text-center mb-4",children:s.jsx("div",{className:"bg-white p-4 rounded-lg inline-block",children:s.jsx(c,{src:m.qrCodeUrl,alt:"TOTP QR Code",className:"w-48 h-48 mx-auto"})})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Or enter this secret key manually:"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",value:m.secret,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm font-mono"}),s.jsx("button",{onClick:async()=>{m?.secret&&(await navigator.clipboard.writeText(m.secret),N(!0),n.success("Secret key copied to clipboard"),setTimeout(()=>N(!1),2e3))},className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:f?s.jsx(a,{className:"h-4 w-4 text-green-600"}):s.jsx(r,{className:"h-4 w-4"})})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(i,{className:"h-5 w-5 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"Instructions:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[s.jsx("li",{children:"Install an authenticator app (Google Authenticator, Authy, etc.)"}),s.jsx("li",{children:"Scan the QR code or enter the secret key"}),s.jsx("li",{children:"Enter the 6-digit code from your app below"})]})]})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter verification code from your authenticator app:"}),s.jsx("input",{type:"text",value:h,onChange:e=>{const s=e.target.value.replace(/\D/g,"").slice(0,6);p(s)},placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-mono tracking-widest",maxLength:6})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>{j("initial"),u(null),p("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(h&&6===h.length){g(!0);try{const{data:{session:e}}=await o.auth.getSession();if(!e)return void n.error("Please log in to verify TOTP");const s=await fetch("/api/mfa/totp/verify",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({token:h})});if(s.ok)n.success("TOTP authentication enabled successfully!"),j("initial"),u(null),p(""),x();else{const e=await s.json();n.error(e.message||"Invalid verification code")}}catch(e){n.error("Error verifying TOTP code")}finally{g(!1)}}else n.error("Please enter a valid 6-digit code")},disabled:b||6!==h.length,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b?"Verifying...":"Verify & Enable"})]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx(l,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Authenticator App (TOTP)"}),s.jsx("p",{className:"text-gray-600",children:"Use an authenticator app to generate time-based verification codes"})]}),d?s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(a,{className:"h-5 w-5 text-green-600"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-green-800",children:"TOTP Authentication Enabled"}),s.jsx("p",{className:"text-sm text-green-700",children:"Your account is protected with authenticator app codes"})]})]})}):s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(i,{className:"h-5 w-5 text-yellow-600"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"TOTP Authentication Disabled"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Enable TOTP for enhanced account security"})]})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"How it works:"}),s.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[s.jsx("li",{children:"• Install an authenticator app on your phone"}),s.jsx("li",{children:"• Scan a QR code to link your account"}),s.jsx("li",{children:"• Enter 6-digit codes when logging in"}),s.jsx("li",{children:"• Works offline and is very secure"})]})]}),s.jsx("div",{className:"flex space-x-3",children:d?s.jsx("button",{onClick:async()=>{if(confirm("Are you sure you want to disable TOTP authentication? This will reduce your account security.")){g(!0);try{const{data:{session:e}}=await o.auth.getSession();if(!e)return void n.error("Please log in to disable TOTP");const s=await fetch("/api/mfa/totp/disable",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`}});if(s.ok)n.success("TOTP authentication disabled"),x();else{const e=await s.json();n.error(e.message||"Failed to disable TOTP")}}catch(e){n.error("Error disabling TOTP")}finally{g(!1)}}},disabled:b,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b?"Disabling...":"Disable TOTP"}):s.jsx("button",{onClick:async()=>{g(!0);try{const{data:{session:e}}=await o.auth.getSession();if(!e)return void n.error("Please log in to set up TOTP");const s=await fetch("/api/mfa/totp/setup",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json();u(e),j("setup")}else{const e=await s.json();n.error(e.message||"Failed to start TOTP setup")}}catch(e){n.error("Error starting TOTP setup")}finally{g(!1)}},disabled:b,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b?"Setting up...":"Set up TOTP"})})]})]})};export{d as default};

apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: vault
data:
  vault.hcl: |
    ui = true
    
    listener "tcp" {
      address = "0.0.0.0:8200"
      tls_disable = 1
    }
    
    storage "consul" {
      address = "consul:8500"
      path = "vault/"
    }
    
    # Enable API addr
    api_addr = "http://vault:8200"
    cluster_addr = "https://vault:8201"
    
    # Disable mlock for containerized environments
    disable_mlock = true
    
    # Enable audit logging
    log_level = "INFO"
    log_format = "json"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-policies
  namespace: vault
data:
  smc-trading-policy.hcl: |
    # Policy for SMC Trading Agent
    path "secret/data/smc-trading/*" {
      capabilities = ["create", "read", "update", "delete", "list"]
    }
    
    path "secret/metadata/smc-trading/*" {
      capabilities = ["list"]
    }
    
    # Database credentials
    path "database/creds/smc-trading-role" {
      capabilities = ["read"]
    }
    
    # Transit engine for encryption
    path "transit/encrypt/smc-trading" {
      capabilities = ["update"]
    }
    
    path "transit/decrypt/smc-trading" {
      capabilities = ["update"]
    }
  
  api-gateway-policy.hcl: |
    # Policy for API Gateway
    path "secret/data/api-gateway/*" {
      capabilities = ["read"]
    }
    
    path "auth/token/lookup-self" {
      capabilities = ["read"]
    }
    
    path "auth/token/renew-self" {
      capabilities = ["update"]
    }
  
  execution-engine-policy.hcl: |
    # Policy for Execution Engine
    path "secret/data/execution-engine/*" {
      capabilities = ["read"]
    }
    
    path "secret/data/exchanges/*" {
      capabilities = ["read"]
    }
    
    path "transit/encrypt/execution-engine" {
      capabilities = ["update"]
    }
    
    path "transit/decrypt/execution-engine" {
      capabilities = ["update"]
    }
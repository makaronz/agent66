# Trading App v2 - Configuration Guide

## üîß **Environment Configuration**

### **Backend Configuration**

**File**: `backend/.env`

```bash
# Server
PORT=5001
NODE_ENV=development

# Database
MONGO_URI=mongodb://localhost:27017/trading-app

# Authentication
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=1d

# External APIs (Optional)
OPENWEATHERMAP_API_KEY=your-api-key-here
```

### **Frontend Configuration**

**File**: `frontend/.env`

```bash
# Backend API URL
REACT_APP_API_URL=http://localhost:5001/api
```

---

## üöÄ **Setup Instructions**

### **Backend Setup**
```bash
cd backend
cp .env.example .env
# Edit .env with your values
npm install
npm run dev
```

### **Frontend Setup**
```bash
cd frontend
cp .env.example .env
# Edit .env with backend URL
npm install
npm start
```

---

## üö® **Common Configuration Issues**

### **1. Missing Environment Variables**
**Problem**: Application won't start without required env vars
**Solution**: Copy .env.example and fill in values
```bash
# Backend
cd backend
cp .env.example .env
# Edit .env - set JWT_SECRET, MONGO_URI

# Frontend  
cd frontend
cp .env.example .env
# Edit .env - set REACT_APP_API_URL
```

### **2. MongoDB Not Running**
**Problem**: Backend fails with "MongoDB connection error"
**Solution**: Start MongoDB service
```bash
# macOS with Homebrew
brew services start mongodb-community

# Verify it's running
ps aux | grep mongod
```

### **3. Port Already in Use**
**Problem**: "Port 5001 already in use"
**Solution**: Kill process or change port
```bash
# Find process using port
lsof -i :5001

# Kill process
kill -9 <PID>

# Or change PORT in backend/.env
```

### **4. CORS Errors in Browser**
**Problem**: "CORS policy blocked"
**Solution**: Ensure backend CORS allows frontend origin
```typescript
// backend/src/server.ts - verify this is present
app.use(cors({ 
  origin: process.env.FRONTEND_URL || 'http://localhost:3000' 
}));
```

## üìã **Required Configuration Sections**

### **decision_engine Section**
```yaml
decision_engine:
  model_ensemble:
    enabled: true
    models: ["lstm", "transformer", "ensemble"]
    confidence_threshold: 0.7
    update_interval: 300
    retraining_threshold: 0.6
    model_selection_strategy: "adaptive"
  
  trading_strategy:
    smc_enabled: true
    trend_following: true
    mean_reversion: false
    breakout_detection: true
    risk_adjustment: true
    
  signal_generation:
    min_confidence: 0.8
    max_signals_per_hour: 10
    signal_expiry: 3600
    confirmation_required: true
```

### **data_pipeline.ingestion Section**
```yaml
data_pipeline:
  ingestion:
    source: "exchanges"
    symbols: ["BTCUSDT", "ETHUSDT", "ADAUSDT", "DOTUSDT", "LINKUSDT"]
    timeframe: "1m"
    batch_size: 1000
    max_latency: 1000
```

### **smc_detector.indicators Section**
```yaml
smc_detector:
  indicators:
    - name: "order_block"
      enabled: true
      params:
        min_volume: 1000000
        min_price_change: 0.001
    - name: "liquidity_grab"
      enabled: true
      params:
        min_volume: 500000
        min_price_change: 0.002
    - name: "fair_value_gap"
      enabled: true
      params:
        min_gap_size: 0.001
        max_fill_time: 300
```

## üîß **Configuration Validation Rules**

### **Validator Expectations**
- **Indicators**: Must be list of dictionaries with `name` and `params`
- **Circuit breaker threshold**: Must be integer (not float)
- **Required sections**: Must exist in config.yaml
- **Data types**: Must match expected formats

### **Common Validation Errors**
1. **"Data pipeline source is required"**
   - Missing `data_pipeline.ingestion.source`

2. **"At least one trading symbol is required"**
   - Missing `data_pipeline.ingestion.symbols` list

3. **"Each indicator must be a dictionary"**
   - `smc_detector.indicators` must be list of dicts, not booleans

4. **"Circuit breaker threshold must be an integer"**
   - `risk_manager.circuit_breaker_threshold` must be integer (e.g., 10 not 0.1)

## üöÄ **Configuration Fix Strategy**

### **Phase 1: Restore Required Sections**
1. Add missing `decision_engine` section
2. Add missing `data_pipeline.ingestion` section
3. Fix `smc_detector.indicators` format

### **Phase 2: Fix Validation Issues**
1. Ensure all required fields exist
2. Fix data type mismatches
3. Test configuration loading

### **Phase 3: Re-enable Validation**
1. Uncomment validation calls
2. Test startup process
3. Verify all sections pass validation

## üìÅ **Configuration Files**

### **Current Application**
- [backend/.env.example](mdc:backend/.env.example) - Backend configuration template
- [frontend/.env.example](mdc:frontend/.env.example) - Frontend configuration template
- [backend/src/server.ts](mdc:backend/src/server.ts) - Server configuration
- [frontend/src/App.tsx](mdc:frontend/src/App.tsx) - React app configuration

### **Legacy System (app_old/)**
- [app_old/config.yaml](mdc:app_old/config.yaml) - Legacy main configuration file
- [app_old/config_loader.py](mdc:app_old/config_loader.py) - Legacy configuration loading logic
- [app_old/config_validator.py](mdc:app_old/config_validator.py) - Legacy validation rules
- [app_old/env.example](mdc:app_old/env.example) - Legacy environment variables template

## ‚ö†Ô∏è **Important Notes**

1. **Don't mix relative/direct imports** in configuration files
2. **YAML structure must be valid** - check for duplicate keys
3. **Validation is currently disabled** for development
4. **Vault integration failures** are non-critical (falls back to env vars)
5. **Logging conflicts** resolved with basic setup

## üîç **Debugging Legacy Configuration Issues (app_old/)**

### **Check Configuration Loading**
```bash
cd app_old
python -c "from config_loader import load_secure_config; print('‚úÖ Config loader works')"
```

### **Test Specific Sections**
```bash
cd app_old  
python -c "import yaml; config=yaml.safe_load(open('config.yaml')); print('decision_engine' in config)"
```

### **Validate YAML Syntax**
```bash
cd app_old
python -c "import yaml; yaml.safe_load(open('config.yaml')); print('‚úÖ YAML syntax valid')"
```

---

**Legacy Status**: Configuration validation is disabled for development. This applies only to app_old/ legacy system.
description:
globs:
alwaysApply: true
---

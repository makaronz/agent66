# Trading App v2 - Import Structure & Module Organization

**âš ï¸ MIGRATION NOTICE: Repository restructured on October 3, 2025**

## ğŸ—ï¸ **Current Application Structure**

### **Active Application: backend/ + frontend/**
- Backend: Express + TypeScript + MongoDB
- Frontend: React 18 + Redux Toolkit + TypeScript
- No Python modules in main application

### **Legacy System: app_old/**
- Python FastAPI + Rust execution engine
- All Python modules archived to app_old/

---

## ğŸš¨ **Critical Import Rules**

### **TypeScript Import Structure (Current Application)**

#### **Backend (Express + TypeScript)**
**Use standard ES module imports:**
```typescript
// âœ… CORRECT for backend
import express from 'express';
import { Router } from 'express';
import { authGuard } from './middleware/auth';
import { User } from './models/User';
import swaggerUi from 'swagger-ui-express';
```

#### **Frontend (React + TypeScript)**
**Use relative imports:**
```typescript
// âœ… CORRECT for frontend
import React from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { Provider } from 'react-redux';
import { store } from './store/store';
import LoginForm from './components/LoginForm';
import Dashboard from './components/Dashboard';
```

---

## ğŸ“ **Legacy Python Import Structure (app_old/ only)**

### **Python Import Structure**

#### **Root Level Files** (Files in app_old/ root)
**Use DIRECT imports only:**
```python
# âœ… CORRECT for root files in app_old/
from config_loader import load_secure_config
from config_validator import validate_config
from error_handlers import CircuitBreaker, RetryHandler
from validators import data_validator, DataQualityLevel
from vault_client import get_vault_client, VaultClientError
from data_pipeline.ingestion import DataIngestion
from smc_detector.indicators import SMCIndicators
from decision_engine.model_ensemble import AdaptiveModelSelector
from risk_manager.smc_risk_manager import SMCRiskManager
from service_manager import ServiceManager
from health_monitor import HealthMonitor
```

**âŒ NEVER use relative imports in root files:**
```python
# âŒ WRONG for root files
from .config_loader import load_secure_config
from .error_handlers import CircuitBreaker
from ..monitoring.data_quality_metrics import set_freshness
```

#### **Module Files** (Files inside packages)
**Use RELATIVE imports within packages:**
```python
# âœ… CORRECT for module files
from .exchange_connectors import ExchangeConnector, BinanceConnector
from .kafka_producer import KafkaProducerManager
from ..monitoring.data_quality_metrics import set_freshness
from ..health_monitor import HealthMonitor
```

**âŒ NEVER use direct imports in module files:**
```python
# âŒ WRONG for module files
from config_loader import load_secure_config
from error_handlers import CircuitBreaker
```

### **Legacy TypeScript Structure (app_old/src/ only)**

#### **Old structure used @/ alias:**
```typescript
// âœ… CORRECT for app_old/src/ TypeScript
import Layout from "@/components/Layout";
import Dashboard from "@/pages/Dashboard";
import { AuthProvider } from "@/contexts/AuthContext";
import { QueryProvider } from "@/providers/QueryProvider";
import LoadingSpinner from "@/components/ui/LoadingSpinner";
```

**Note**: This pattern applies only to legacy code in app_old/src/

## ğŸ“ **Module Organization**

### **Current Application Structure**

#### **Backend (Express + TypeScript)**
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.ts             # Express server
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # Authentication routes
â”‚   â”‚   â”œâ”€â”€ posts.ts          # Post management
â”‚   â”‚   â””â”€â”€ weather.ts        # Weather API integration
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.ts           # Mongoose User model
â”‚   â”‚   â””â”€â”€ Post.ts           # Mongoose Post model
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # JWT authentication
â”‚   â”‚   â””â”€â”€ validation.ts     # Request validation
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ swagger.ts        # API documentation
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

#### **Frontend (React + Redux Toolkit)**
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx               # Main app component
â”‚   â”œâ”€â”€ index.tsx             # React entry point
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx     # Login component
â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx  # Registration component
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx     # Dashboard view
â”‚   â”‚   â”œâ”€â”€ AddDataForm.tsx   # Data entry form
â”‚   â”‚   â””â”€â”€ PrivateRoute.tsx  # Route protection
â”‚   â””â”€â”€ store/
â”‚       â”œâ”€â”€ store.ts          # Redux store config
â”‚       â””â”€â”€ slices/
â”‚           â”œâ”€â”€ authSlice.ts  # Auth state management
â”‚           â””â”€â”€ postSlice.ts  # Post state management
â”œâ”€â”€ package.json
â””â”€â”€ tailwind.config.js
```

### **Legacy Python Package Structure (app_old/ only)**
```
app_old/
â”œâ”€â”€ main.py                    # Root - direct imports
â”œâ”€â”€ config_loader.py          # Root - direct imports
â”œâ”€â”€ config_validator.py       # Root - direct imports
â”œâ”€â”€ error_handlers.py         # Root - direct imports
â”œâ”€â”€ validators.py             # Root - direct imports
â”œâ”€â”€ vault_client.py           # Root - direct imports
â”œâ”€â”€ data_pipeline/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ingestion.py          # Module - relative imports
â”‚   â””â”€â”€ exchange_connectors/
â”‚       â”œâ”€â”€ __init__.py       # Module - relative imports
â”‚       â””â”€â”€ binance_connector.py
â”œâ”€â”€ smc_detector/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ indicators.py         # Module - relative imports
â””â”€â”€ risk_manager/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ smc_risk_manager.py   # Module - relative imports
```

### **Legacy TypeScript Structure (app_old/src/ only)**
```
app_old/src/
â”œâ”€â”€ main.tsx                  # Root - @/ imports
â”œâ”€â”€ App.tsx                   # Root - @/ imports
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Layout.tsx            # Module - @/ imports
â”‚   â””â”€â”€ ui/LoadingSpinner.tsx # Module - @/ imports
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Dashboard.tsx         # Module - @/ imports
â”‚   â””â”€â”€ TradingInterface.tsx  # Module - @/ imports
â””â”€â”€ contexts/
    â””â”€â”€ AuthContext.tsx       # Module - @/ imports
```

## ğŸ”§ **Common Import Issues & Fixes**

### **Issue 1: Relative Import Beyond Top-Level Package**
**Error**: `ImportError: attempted relative import beyond top-level package`
**Cause**: Using `..` in root files or wrong package structure
**Solution**: 
- Root files: Use direct imports
- Module files: Use relative imports within package boundaries

### **Issue 2: Cannot Import Name**
**Error**: `ImportError: cannot import name 'ClassName' from 'module'`
**Cause**: Missing exports in `__init__.py` files
**Solution**: Add proper exports in package `__init__.py` files

**Example fix for data_pipeline/exchange_connectors/__init__.py:**
```python
# Import specific connectors for direct access
try:
    from .binance_connector import BinanceConnector
    from .bybit_connector import ByBitConnector
    from .oanda_connector import OANDAConnector
except ImportError as e:
    logger.warning(f"Could not import some connectors: {e}")
    # Define placeholder classes if imports fail
    BinanceConnector = None
    ByBitConnector = None
    OANDAConnector = None

# Package exports
__all__ = [
    'ExchangeConnector',
    'BinanceConnector',
    'ByBitConnector',
    'OANDAConnector',
    # ... other exports
]
```

### **Issue 3: Import Resolution in Different Contexts**
**Error**: Import works in one context but fails in another
**Cause**: Different working directories or Python path issues
**Solution**: 
- Test imports from project root: `python -c "import module"`
- Ensure PYTHONPATH includes project root
- Use absolute imports for root files

## ğŸ§ª **Testing Import Resolution**

### **Test Current Application**
```bash
# Backend TypeScript compilation
cd backend
npm run build

# Frontend TypeScript compilation  
cd frontend
npm test -- --passWithNoTests

# Backend tests
cd backend && npm test

# Frontend tests
cd frontend && npm test
```

### **Test Legacy Python Imports (app_old/ only)**
```bash
# From app_old directory
cd /Users/arkadiuszfudali/Git/agent66/app_old

# Test main module
python -c "import main; print('âœ… main.py imports successfully')"

# Test specific modules
python -c "from data_pipeline.ingestion import DataIngestion; print('âœ… DataIngestion imported')"
python -c "from risk_manager.smc_risk_manager import SMCRiskManager; print('âœ… SMCRiskManager imported')"
```

## ğŸ“‹ **Import Checklist**

When adding new imports:

1. **Check file location**: Root vs module file?
2. **Choose import style**: Direct vs relative?
3. **Verify package structure**: Is the module in the right package?
4. **Check __init__.py exports**: Are classes/functions exported?
5. **Test import resolution**: Does `python -c "import module"` work?

## âš ï¸ **Important Reminders**

### **Current Application (backend/ + frontend/)**
1. **Backend TypeScript** â†’ Standard ES module imports with relative paths
2. **Frontend TypeScript** â†’ Relative imports (no @/ alias configured)
3. **Both use TypeScript** â†’ Type safety throughout
4. **No Python code** â†’ All Python is in app_old/

### **Legacy System (app_old/ only)**  
1. **Root Python files** â†’ **Direct imports only**
2. **Module Python files** â†’ **Relative imports within package**
3. **Legacy TypeScript** â†’ **@/ alias imports** (app_old/src/)
4. **Package boundaries** â†’ **Respect package structure**
5. **__init__.py files** â†’ **Export all public classes/functions**

---

**Remember**: As of October 3, 2025, the main application is TypeScript-based (backend/ + frontend/). Python code is archived in app_old/ for reference only.
description:
globs:
alwaysApply: true
---

# Trading App v2 - Development Rules & Guidelines

## üèóÔ∏è **Project Architecture Overview**

**‚ö†Ô∏è MIGRATION NOTICE: This repository was restructured on October 3, 2025**

### **Current Active Application (Main)**
This is a modern full-stack trading application built with:
- **Frontend**: React 18.2 + TypeScript + Redux Toolkit (port 3000)
- **Backend**: Node.js + Express 4.18 + TypeScript + MongoDB (port 5001)
- **Database**: MongoDB 8.x (Mongoose ODM)
- **Deployment**: Vercel (Frontend), Heroku/AWS (Backend)

### **Legacy System (Archived to app_old/)**
Previous Smart Money Concepts (SMC) trading system:
- **Frontend**: React + TypeScript + Vite (port 5173)
- **Backend**: Python FastAPI + Rust execution engine
- **Database**: PostgreSQL + Redis
- **Location**: `/app_old` directory

## üö® **Critical Import Rules**

### **TypeScript Import Structure (Current Backend & Frontend)**

#### **Backend (Express + TypeScript)**
- Standard **ES module imports** with TypeScript
- Relative imports for local files
- No `@/` alias in backend

**‚úÖ Correct backend imports:**
```typescript
import express from 'express';
import { authGuard } from './middleware/auth';
import { User } from './models/User';
import { validateRequest } from './middleware/validation';
```

#### **Frontend (React + TypeScript)**
- Standard **relative imports** (no @/ alias currently configured)
- Import from React, Redux Toolkit, etc.

**‚úÖ Correct frontend imports:**
```typescript
import React from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { loginUser } from '../store/slices/authSlice';
import LoginForm from './components/LoginForm';
```

### **Legacy Python Import Structure (app_old/ only)**
- **Root level files** in app_old/ use **direct imports**
- **Module files** use **relative imports** within packages
- See app_old/ documentation for Python-specific patterns

## üîß **Common Issues & Fixes**

### **1. Decorator Issues**
**Problem**: `TypeError: 'str' object is not callable`
**Solution**: Ensure decorators are properly defined as static methods or functions

**‚úÖ Correct decorator pattern:**
```python
@staticmethod
def _retry_on_failure(func):
    def decorator(func: Callable) -> Callable:
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            # implementation
            return func(*args, **kwargs)
        return wrapper
    return decorator
```

### **2. Import Resolution Issues**
**Problem**: `ImportError: attempted relative import with no known parent package`
**Solution**: 
- Root files: Use direct imports
- Module files: Use relative imports
- Check file location in project structure

### **3. Configuration Validation Issues**
**Problem**: Strict validation blocking startup
**Solution**: 
- Temporarily disable validation in `config_loader.py`
- Comment out `validate_config` calls in `main.py`
- Use basic logging setup instead of complex config

## üìÅ **Key File Locations**

### **Current Application (Root Level)**
- [README.md](mdc:README.md) - Main project documentation
- [backend/package.json](mdc:backend/package.json) - Backend dependencies
- [frontend/package.json](mdc:frontend/package.json) - Frontend dependencies

### **Backend Structure**
- [backend/src/server.ts](mdc:backend/src/server.ts) - Express server entry point
- [backend/src/routes/](mdc:backend/src/routes/) - API route handlers
- [backend/src/models/](mdc:backend/src/models/) - Mongoose models (User, Post)
- [backend/src/middleware/](mdc:backend/src/middleware/) - Auth & validation middleware
- [backend/.env](mdc:backend/.env) - Environment configuration

### **Frontend Structure**
- [frontend/src/App.tsx](mdc:frontend/src/App.tsx) - React app entry
- [frontend/src/components/](mdc:frontend/src/components/) - React components
- [frontend/src/store/](mdc:frontend/src/store/) - Redux store & slices
- [frontend/.env](mdc:frontend/.env) - Frontend environment config

### **Legacy System (Archived)**
- [app_old/main.py](mdc:app_old/main.py) - Legacy Python entry point
- [app_old/config.yaml](mdc:app_old/config.yaml) - Legacy configuration
- [app_old/src/](mdc:app_old/src/) - Legacy React/Rust code
- See app_old/ for complete legacy documentation

## üöÄ **Development Workflow**

### **Starting Current Application**
```bash
# Backend (port 5001)
cd backend
npm install
npm run dev

# Frontend (port 3000)  
cd frontend
npm install
npm start

# Run tests
cd backend && npm test
cd frontend && npm test
```

### **Testing Application**
```bash
# Verify backend API
curl http://localhost:5001/api

# Verify Swagger docs
open http://localhost:5001/api-docs

# Verify frontend
open http://localhost:3000
```

### **Legacy System (app_old/)**
```bash
# For working with legacy Python/Rust code
cd app_old
python main.py

# Test Python imports (legacy)
cd app_old && python -c "import main; print('‚úÖ All imports working')"
```

## ‚ö†Ô∏è **Known Issues & Considerations**

### **Current Application**
- **Port 5000 Conflict**: macOS ControlCenter uses port 5000, backend uses 5001
- **Frontend Vulnerabilities**: 10 npm vulnerabilities detected (3 moderate, 7 high)
  - Run `cd frontend && npm audit fix` to address
- **OpenWeatherMap API**: Weather route requires API key in backend/.env

### **Legacy System (app_old/ only)**
**Note**: These issues apply only to archived code in app_old/

- **Configuration Validation**: Disabled in app_old/config_loader.py
- **Vault Integration**: Falls back to environment variables  
- **Logging Configuration**: Uses basic logging setup

## üéØ **Development Priorities**

### **High Priority (Fix First)**
1. ‚úÖ Import resolution issues - **FIXED**
2. ‚úÖ Decorator syntax errors - **FIXED**
3. ‚úÖ Module export issues - **FIXED**
4. ‚ö†Ô∏è Configuration validation - **PARTIALLY FIXED**

### **Medium Priority**
1. Fix config.yaml structure and validation
2. Restore proper logging configuration
3. Fix Vault integration issues

### **Low Priority**
1. Optimize build configuration
2. Add comprehensive error handling
3. Improve configuration management

## üîç **Debugging Checklist**

When encountering issues:

1. **Check import structure** - Root vs module files
2. **Verify decorator syntax** - Static methods vs instance methods
3. **Test import resolution** - Use `python -c "import module"`
4. **Check configuration** - Validate config.yaml structure
5. **Review error messages** - Look for specific import/validation errors

## üìö **Reference Links**

### **Current Application**
- [README.md](mdc:README.md) - Main project documentation
- [backend/README.md](mdc:backend/README.md) - Backend documentation
- [frontend/README.md](mdc:frontend/README.md) - Frontend documentation
- [MIGRATION_PLAN_APP_V2.md](mdc:MIGRATION_PLAN_APP_V2.md) - Migration details

### **Legacy System (Archived)**
- [app_old/TASK_log.md](mdc:app_old/TASK_log.md) - Legacy task history
- [app_old/DEPLOYMENT.md](mdc:app_old/DEPLOYMENT.md) - Legacy deployment docs
- [app_old/README.md](mdc:app_old/README.md) - Legacy system documentation

---

**Remember**: As of October 3, 2025, the main application is backend/ + frontend/. Legacy Python/Rust code is archived in app_old/.
description:
globs:
alwaysApply: true
---

# SMC Trading Agent - Development Rules & Guidelines

## üèóÔ∏è **Project Architecture Overview**

This is a comprehensive Smart Money Concepts (SMC) trading system built with:
- **Frontend**: React + TypeScript + Vite (port 5173)
- **Backend**: Python FastAPI + Rust execution engine
- **Database**: PostgreSQL + Redis
- **Deployment**: Vercel (Frontend), Kubernetes (Backend)

## üö® **Critical Import Rules**

### **Python Import Structure**
- **Root level files** (main.py, validators.py, etc.) use **direct imports**
- **Module files** use **relative imports** within their packages
- **NEVER mix** relative and direct imports in the same file

**‚úÖ Correct imports for root files:**
```python
from config_loader import load_secure_config
from data_pipeline.ingestion import DataIngestion
from risk_manager.smc_risk_manager import SMCRiskManager
```

**‚úÖ Correct imports for module files:**
```python
from .exchange_connectors import ExchangeConnector
from ..monitoring.data_quality_metrics import set_freshness
```

### **TypeScript Import Structure**
- Use **absolute imports** with `@/` alias
- All imports resolve from `src/` directory
- Follow the pattern: `@/components/`, `@/pages/`, `@/hooks/`

## üîß **Common Issues & Fixes**

### **1. Decorator Issues**
**Problem**: `TypeError: 'str' object is not callable`
**Solution**: Ensure decorators are properly defined as static methods or functions

**‚úÖ Correct decorator pattern:**
```python
@staticmethod
def _retry_on_failure(func):
    def decorator(func: Callable) -> Callable:
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            # implementation
            return func(*args, **kwargs)
        return wrapper
    return decorator
```

### **2. Import Resolution Issues**
**Problem**: `ImportError: attempted relative import with no known parent package`
**Solution**: 
- Root files: Use direct imports
- Module files: Use relative imports
- Check file location in project structure

### **3. Configuration Validation Issues**
**Problem**: Strict validation blocking startup
**Solution**: 
- Temporarily disable validation in `config_loader.py`
- Comment out `validate_config` calls in `main.py`
- Use basic logging setup instead of complex config

## üìÅ **Key File Locations**

### **Core Application Files**
- [main.py](mdc:main.py) - Main application entry point
- [config.yaml](mdc:config.yaml) - Configuration file (has validation issues)
- [package.json](mdc:package.json) - Frontend dependencies and scripts
- [requirements.txt](mdc:requirements.txt) - Python dependencies

### **Critical Python Modules**
- [vault_client.py](mdc:vault_client.py) - Secure configuration management
- [error_handlers.py](mdc:error_handlers.py) - Error handling and decorators
- [validators.py](mdc:validators.py) - Data validation logic
- [config_loader.py](mdc:config_loader.py) - Configuration loading (validation disabled)

### **Frontend Structure**
- [src/main.tsx](mdc:src/main.tsx) - React application entry point
- [src/App.tsx](mdc:src/App.tsx) - Main application component
- [vite.config.ts](mdc:vite.config.ts) - Vite build configuration
- [tsconfig.json](mdc:tsconfig.json) - TypeScript configuration

## üöÄ **Development Workflow**

### **Starting Development Environment**
```bash
# Frontend (port 5173)
npm run client:dev

# Backend (Python)
python main.py

# Type checking
npm run check

# Build
npm run build:vite-only
```

### **Testing Import Resolution**
```bash
# Test Python imports
python -c "import main; print('‚úÖ All imports working')"

# Test TypeScript compilation
npm run check
```

## ‚ö†Ô∏è **Known Issues & Workarounds**

### **1. Configuration Validation**
- **Issue**: Strict validation blocks startup
- **Workaround**: Disabled in `config_loader.py` and `main.py`
- **Status**: Needs proper config.yaml fixes

### **2. Vault Integration**
- **Issue**: Authentication failures
- **Workaround**: Falls back to environment variables
- **Status**: Non-critical for development

### **3. Logging Configuration**
- **Issue**: Complex logging config conflicts
- **Workaround**: Use basic logging setup
- **Status**: Functional but not optimal

## üéØ **Development Priorities**

### **High Priority (Fix First)**
1. ‚úÖ Import resolution issues - **FIXED**
2. ‚úÖ Decorator syntax errors - **FIXED**
3. ‚úÖ Module export issues - **FIXED**
4. ‚ö†Ô∏è Configuration validation - **PARTIALLY FIXED**

### **Medium Priority**
1. Fix config.yaml structure and validation
2. Restore proper logging configuration
3. Fix Vault integration issues

### **Low Priority**
1. Optimize build configuration
2. Add comprehensive error handling
3. Improve configuration management

## üîç **Debugging Checklist**

When encountering issues:

1. **Check import structure** - Root vs module files
2. **Verify decorator syntax** - Static methods vs instance methods
3. **Test import resolution** - Use `python -c "import module"`
4. **Check configuration** - Validate config.yaml structure
5. **Review error messages** - Look for specific import/validation errors

## üìö **Reference Links**

- [TASK_log.md](mdc:TASK_log.md) - Task execution history
- [README.md](mdc:README.md) - Project documentation
- [DEPLOYMENT.md](mdc:DEPLOYMENT.md) - Deployment instructions

---

**Remember**: This project has complex import dependencies. Always verify import paths and use the correct import style for each file's location in the project structure.
description:
globs:
alwaysApply: true
---
